<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Basic SEO Meta Tags -->
  <meta charset="UTF-8">
  <meta name="description" content="Advanced Chest Infection vs Pneumonia Diagnostic Tool – Integrates symptom selection, wearable data, lung sound analysis, and chatbot assistance for early respiratory diagnostics.">
  <meta name="keywords" content="chest infection, pneumonia, diagnostic tool, wearable data, lung sound analysis, digital health, respiratory diagnostics, chatbot, SEO">
  <meta name="author" content="Health Insights">
  <meta name="robots" content="index, follow">
  
  <!-- Open Graph Tags for Social Sharing -->
  <meta property="og:title" content="Advanced Chest Infection vs Pneumonia Diagnostic Tool">
  <meta property="og:description" content="An innovative diagnostic tool integrating multi‑modal data to help distinguish between chest infection and pneumonia.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://yourdomain.example/path/to/tool">
  <meta property="og:image" content="https://yourdomain.example/path/to/preview-image.jpg">
  
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Advanced Chest Infection vs Pneumonia Diagnostic Tool</title>
  <!-- Chart.js Library -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- jsPDF Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    /* Global Styles */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f4f4f9;
      color: #333;
      transition: background-color 0.3s, color 0.3s;
    }
    body.dark {
      background-color: #2c3e50;
      color: #ecf0f1;
    }
    h1, h2 {
      color: #2c3e50;
    }
    body.dark h1, body.dark h2 {
      color: #ecf0f1;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background-color: #fff;
      padding: 30px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      border-radius: 5px;
      transition: background-color 0.3s, color 0.3s;
    }
    body.dark .container {
      background-color: #34495e;
      color: #ecf0f1;
    }
    p { line-height: 1.6; }
    ul { margin: 0 0 20px 20px; }
    /* Table Styles */
    table {
      width: 100%; 
      border-collapse: collapse; 
      margin-top: 20px;
    }
    table th, table td {
      border: 1px solid #ddd; 
      padding: 10px; 
      text-align: left;
    }
    table th { background-color: #2c3e50; color: #fff; }
    /* Buttons */
    .btn {
      background-color: #3498db; 
      color: #fff;
      padding: 10px 15px; 
      border: none; 
      border-radius: 3px;
      cursor: pointer; 
      margin-top: 20px; 
      margin-right: 10px;
      transition: background-color 0.3s;
    }
    .btn:hover { background-color: #2980b9; }
    /* Toggle details */
    .details {
      display: none; 
      margin-top: 20px; 
      opacity: 0; 
      transition: opacity 0.5s ease;
    }
    .details.show {
      display: block; 
      opacity: 1;
    }
    /* Selector Styles */
    .symptom-selection, .risk-factor-selection {
      margin-top: 40px; 
      padding-top: 20px; 
      border-top: 1px solid #ccc;
    }
    .symptom-selection h2, .risk-factor-selection h2 { margin-bottom: 10px; }
    .symptom-selection form, .risk-factor-selection form { display: flex; flex-wrap: wrap; }
    .symptom-selection label, .risk-factor-selection label {
      width: 48%; 
      margin: 5px 1%; 
      background: #e8f0fe; 
      padding: 8px;
      border-radius: 4px; 
      cursor: pointer; 
      transition: background 0.3s;
    }
    .symptom-selection label:hover, .risk-factor-selection label:hover { background: #d0e3fc; }
    .symptom-selection input[type="checkbox"],
    .risk-factor-selection input[type="checkbox"] { margin-right: 8px; }
    /* Evaluation & Summary */
    #evaluationResult, #lastEval, #summaryStats {
      margin-top: 20px; 
      padding: 15px; 
      border: 1px solid #ccc; 
      border-radius: 4px;
      background-color: #fafafa;
    }
    /* Chart containers */
    .chart-container { margin-top: 40px; }
    .chart-container canvas { margin-top: 20px; }
    /* Wearable Dashboard */
    #wearableDashboard {
      margin-top: 40px; 
      padding: 15px; 
      border: 1px solid #ccc; 
      border-radius: 4px;
      background-color: #eef;
    }
    /* Chatbot Interface */
    #chatbotContainer {
      margin-top: 40px; 
      padding: 15px; 
      border: 1px solid #ccc; 
      border-radius: 4px;
      background-color: #f9f9f9;
    }
    #chatLog { 
      max-height: 150px; 
      overflow-y: auto; 
      margin-bottom: 10px; 
      border: 1px solid #ddd; 
      padding: 8px;
    }
    #chatInput { width: 80%; padding: 8px; }
    /* Settings Modal */
    #settingsModal {
      display: none; 
      position: fixed; 
      z-index: 1000; 
      left: 0; 
      top: 0;
      width: 100%; 
      height: 100%; 
      overflow: auto;
      background-color: rgba(0,0,0,0.5);
    }
    #settingsContent {
      background-color: #fff; 
      margin: 10% auto; 
      padding: 20px;
      border: 1px solid #888; 
      width: 80%; 
      max-width: 500px;
      border-radius: 5px;
    }
    /* Journal Section */
    #journalSection {
      margin-top: 40px; 
      padding: 15px; 
      border: 1px solid #ccc; 
      border-radius: 4px;
      background-color: #eef;
    }
    #journalText { width: 100%; height: 100px; }
    /* Latest Health News Ticker */
    #newsTicker {
      margin-top: 40px; 
      padding: 15px; 
      border: 1px solid #ccc; 
      border-radius: 4px;
      background-color: #ffe; 
      overflow: hidden; 
      white-space: nowrap;
    }
    #newsTicker span {
      display: inline-block; 
      padding-right: 50px;
      animation: ticker 15s linear infinite;
    }
    @keyframes ticker {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }
    /* Dark mode button style */
    #toggleThemeBtn { background-color: #2ecc71; }
    #toggleThemeBtn:hover { background-color: #27ae60; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Advanced Chest Infection vs Pneumonia Diagnostic Tool</h1>
    <p>
      This innovative tool integrates multi‑modal data—including symptom selection, risk factors, cough sound analysis, simulated wearable vitals, and lung sound evaluation—to enhance early respiratory diagnostics. It features weighted scoring, dynamic visualizations (bar, radar, pie, and trend charts), voice feedback, dark mode, report export (TXT, PDF, CSV), a chatbot assistant, customizable settings, a personal health journal, a live news ticker, evaluation summary statistics, and social sharing.
    </p>
    
    <!-- Controls -->
    <button class="btn" id="toggleThemeBtn">Toggle Dark Mode</button>
    <button class="btn" id="openSettingsBtn">Settings</button>
    <button class="btn" id="toggleJournalBtn">Toggle Health Journal</button>
    <button class="btn" id="openHelpBtn">Help</button>
    <button class="btn" id="shareTwitterBtn">Share on Twitter</button>
    <button class="btn" id="exportAnalysisBtn">Data Analysis</button>
    
    <!-- Latest Health News Ticker -->
    <div id="newsTicker">
      <span>Latest: New AI tools enhance early pneumonia detection. &nbsp;&nbsp;|&nbsp;&nbsp;Wearable sensors now help predict respiratory distress. &nbsp;&nbsp;|&nbsp;&nbsp;Digital diagnostics pave the way for personalized chest infection treatments.</span>
    </div>
    
    <!-- Symptom and Comparison Content -->
    <h2>Chest Infection (Bronchitis) Symptoms</h2>
    <ul>
      <li title="A persistent cough that can be dry or produce mucus."><strong>Persistent Cough:</strong> May be dry or productive with clear, yellow, or green mucus. [WebMD]</li>
      <li title="Mild fever typically not above 38°C."><strong>Low-Grade Fever:</strong> Mild temperature increase, usually not exceeding 38°C (100.4°F). [Medical News Today]</li>
      <li title="Mild tightness or soreness in the chest."><strong>Chest Discomfort:</strong> Mild tightness or soreness. [Healthline]</li>
      <li title="Occasional wheezing during physical exertion."><strong>Wheezing:</strong> Especially during exertion.</li>
      <li title="Common upper respiratory symptoms like a runny nose or sore throat."><strong>Sore Throat/Runny Nose:</strong> Common in viral infections.</li>
      <li title="General tiredness due to infection."><strong>Fatigue:</strong> General tiredness and malaise.</li>
    </ul>
    
    <h2>Pneumonia Symptoms</h2>
    <ul>
      <li title="High fever can reach up to 40°C."><strong>High Fever:</strong> Often above 38°C (100.4°F) and may reach up to 40°C (104°F). [Healthline]</li>
      <li title="Episodes of intense shivering."><strong>Shaking Chills:</strong> Intense episodes of shivering.</li>
      <li title="A severe cough that produces discolored or blood-tinged sputum."><strong>Severe, Productive Cough:</strong> With yellow, green, or blood-tinged sputum. [Healthline]</li>
      <li title="Sharp pain in the chest that worsens with deep breaths."><strong>Pleuritic Chest Pain:</strong> Sharp, stabbing pain worsening with deep breaths or coughing. [Healthline]</li>
      <li title="Difficulty breathing even when resting."><strong>Marked Shortness of Breath:</strong> Difficulty breathing even at rest. [Healthline]</li>
      <li title="Mental confusion that may indicate low oxygen levels."><strong>Confusion:</strong> Particularly in older adults.</li>
      <li title="Nausea and vomiting may accompany the infection."><strong>Gastrointestinal Symptoms:</strong> Loss of appetite, nausea, or vomiting.</li>
      <li title="Severe cases may show bluish lips or nail beds."><strong>Cyanosis:</strong> Bluish discoloration in severe cases.</li>
    </ul>
    
    <h2>Side-by-Side Comparison</h2>
    <table>
      <thead>
        <tr>
          <th>Symptom</th>
          <th>Chest Infection (Bronchitis)</th>
          <th>Pneumonia</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Cough</td>
          <td>Persistent; may be dry or produce mucus.</td>
          <td>Severe; productive with discolored or blood-tinged sputum.</td>
        </tr>
        <tr>
          <td>Fever</td>
          <td>Low-grade, mild increase.</td>
          <td>High-grade, often exceeding 38°C (100.4°F).</td>
        </tr>
        <tr>
          <td>Chest Pain</td>
          <td>Mild discomfort or tightness.</td>
          <td>Sharp, pleuritic pain.</td>
        </tr>
        <tr>
          <td>Breathing Difficulty</td>
          <td>Occasional wheezing.</td>
          <td>Marked shortness of breath.</td>
        </tr>
        <tr>
          <td>Systemic Symptoms</td>
          <td>Fatigue, sore throat, runny nose.</td>
          <td>Confusion, loss of appetite, nausea, cyanosis.</td>
        </tr>
      </tbody>
    </table>
    
    <button class="btn" onclick="toggleDetails()">Toggle Additional Details</button>
    <div class="details" id="additionalDetails">
      <h2>Additional Details</h2>
      <p>
        A weighted approach using symptom severity and risk factors improves diagnostic accuracy. Advanced methods such as cough sound analysis, simulated lung sound evaluation, and wearable data (heart rate, temperature) further refine the assessment.
      </p>
    </div>
    
    <!-- Evaluation Result & Last Evaluation -->
    <div id="evaluationResult">
      <p><em>This tool is for informational purposes only and is not a substitute for professional medical advice.</em></p>
    </div>
    <div id="lastEval"></div>
    
    <!-- Evaluation Summary Statistics -->
    <div id="summaryStats">
      <h2>Evaluation Summary Statistics</h2>
      <p id="statsText">No evaluations yet.</p>
      <button class="btn" onclick="updateStats()">Update Stats</button>
    </div>
    
    <!-- Wearable Dashboard (includes simulated lung sound analysis) -->
    <div id="wearableDashboard">
      <h2>Wearable Dashboard</h2>
      <p id="wearableData">Loading wearable data...</p>
      <p id="lungSoundData">Loading lung sound data...</p>
    </div>
    
    <!-- Chatbot Assistant -->
    <div id="chatbotContainer">
      <h2>Chatbot Assistant</h2>
      <div id="chatLog"></div>
      <input type="text" id="chatInput" placeholder="Ask a question...">
      <button class="btn" onclick="sendChat()">Send</button>
    </div>
    
    <!-- Canvas Elements for Charts -->
    <div class="chart-container">
      <h2>Symptom Evaluation (Bar Chart)</h2>
      <canvas id="symptomChart"></canvas>
    </div>
    <div class="chart-container">
      <h2>Symptom Proportions (Radar Chart)</h2>
      <canvas id="radarChart"></canvas>
    </div>
    <div class="chart-container">
      <h2>Risk Factor Distribution (Pie Chart)</h2>
      <!-- Optional: if you want a pie chart, include a canvas with id riskPieChart -->
      <canvas id="riskPieChart"></canvas>
    </div>
    <div class="chart-container">
      <h2>Historical Evaluation Trends (Line Chart)</h2>
      <canvas id="trendChart"></canvas>
    </div>
    
    <!-- Symptom Selector Section -->
    <div class="symptom-selection">
      <h2>Select Your Symptoms</h2>
      <form id="symptomForm">
        <label title="Select if you have a persistent cough.">
          <input type="checkbox" name="symptom" value="persistent_cough"> Persistent Cough
        </label>
        <label title="Select if you have a low-grade fever.">
          <input type="checkbox" name="symptom" value="low_grade_fever"> Low-Grade Fever
        </label>
        <label title="Select if you feel mild chest discomfort.">
          <input type="checkbox" name="symptom" value="chest_discomfort"> Mild Chest Discomfort
        </label>
        <label title="Select if you experience wheezing.">
          <input type="checkbox" name="symptom" value="wheezing"> Wheezing
        </label>
        <label title="Select if you have a sore throat or runny nose.">
          <input type="checkbox" name="symptom" value="sore_throat"> Sore Throat/Runny Nose
        </label>
        <label title="Select if you feel unusually fatigued.">
          <input type="checkbox" name="symptom" value="fatigue"> Fatigue
        </label>
        <label title="Select if you have a high fever.">
          <input type="checkbox" name="symptom" value="high_fever"> High Fever
        </label>
        <label title="Select if you experience shaking chills.">
          <input type="checkbox" name="symptom" value="shaking_chills"> Shaking Chills
        </label>
        <label title="Select if you have a severe, productive cough.">
          <input type="checkbox" name="symptom" value="severe_productive_cough"> Severe, Productive Cough
        </label>
        <label title="Select if you have pleuritic chest pain.">
          <input type="checkbox" name="symptom" value="pleuritic_chest_pain"> Pleuritic Chest Pain
        </label>
        <label title="Select if you experience marked shortness of breath.">
          <input type="checkbox" name="symptom" value="shortness_of_breath"> Marked Shortness of Breath
        </label>
        <label title="Select if you experience confusion.">
          <input type="checkbox" name="symptom" value="confusion"> Confusion
        </label>
        <label title="Select if you experience nausea or vomiting.">
          <input type="checkbox" name="symptom" value="nausea"> Nausea/Vomiting
        </label>
        <label title="Select if you notice cyanosis.">
          <input type="checkbox" name="symptom" value="cyanosis"> Cyanosis
        </label>
      </form>
    </div>
    
    <!-- Risk Factor Selection Section -->
    <div class="risk-factor-selection">
      <h2>Select Additional Risk Factors</h2>
      <form id="riskFactorForm">
        <label title="Select if you are over 65 years old.">
          <input type="checkbox" name="risk" value="age_over_65"> Age Over 65
        </label>
        <label title="Select if you are a smoker.">
          <input type="checkbox" name="risk" value="smoker"> Smoker
        </label>
        <label title="Select if you have pre-existing lung conditions.">
          <input type="checkbox" name="risk" value="pre_existing"> Pre-existing Lung Conditions
        </label>
        <label title="Select if you are immunocompromised.">
          <input type="checkbox" name="risk" value="immunocompromised"> Immunocompromised
        </label>
      </form>
    </div>
    
    <!-- Control Buttons -->
    <div>
      <button class="btn" id="evaluateBtn">Evaluate Symptoms</button>
      <button class="btn" id="resetBtn">Reset Selections</button>
      <button class="btn" id="downloadBtn">Download TXT Report</button>
      <button class="btn" id="exportPdfBtn">Export PDF Report</button>
      <button class="btn" id="playBtn">Play Result</button>
      <button class="btn" id="printBtn">Print Report</button>
      <button class="btn" id="recordBtn">Record Cough (5 sec)</button>
      <button class="btn" id="voiceCmdBtn">Voice Command</button>
      <button class="btn" id="shareBtn">Share Result</button>
      <button class="btn" id="exportCsvBtn">Export Trend CSV</button>
    </div>
    
    <!-- Audio Recorder Status -->
    <div class="audio-recorder" id="recorderStatus">
      <p><em>No recording yet.</em></p>
    </div>
    
    <!-- Personal Health Journal Section -->
    <div id="journalSection" style="display: none;">
      <h2>Personal Health Journal</h2>
      <textarea id="journalText" placeholder="Write your daily health notes here..."></textarea>
      <br>
      <button class="btn" onclick="saveJournal()">Save Journal Entry</button>
      <button class="btn" onclick="exportJournal()">Export Journal TXT</button>
      <div id="journalStatus"></div>
    </div>
    
  </div>
  
  <footer>
    <p>&copy; 2025 Health Insights. All rights reserved.</p>
  </footer>
  
  <script>
    // Helper: Safely set innerHTML; if element not found, create it.
    function safeSetInnerHTML(id, content) {
      let el = document.getElementById(id);
      if (!el) {
        el = document.createElement('div');
        el.id = id;
        document.querySelector('.container').appendChild(el);
      }
      el.innerHTML = content;
    }
    
    // Dark mode toggle and theme load
    function toggleTheme() {
      document.body.classList.toggle('dark');
      localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
    }
    function loadTheme() {
      const theme = localStorage.getItem('theme');
      if (theme === 'dark') { document.body.classList.add('dark'); }
    }
    
    // Toggle additional details
    function toggleDetails() {
      const details = document.getElementById('additionalDetails');
      if (details) { details.classList.toggle('show'); }
      else { console.error("additionalDetails element not found."); }
    }
    
    // Global variables for charts
    let symptomChart, radarChart, riskPieChart, trendChart;
    // Ensure that canvas elements exist; if not, log an error.
    const canvasSymptom = document.getElementById('symptomChart');
    const canvasRadar = document.getElementById('radarChart');
    const canvasRiskPie = document.getElementById('riskPieChart');
    const canvasTrend = document.getElementById('trendChart');
    if (!canvasSymptom || !canvasRadar || !canvasTrend) {
      console.error("One or more canvas elements are missing.");
    }
    const chartCtx = canvasSymptom.getContext('2d');
    const radarCtx = canvasRadar.getContext('2d');
    const riskPieCtx = canvasRiskPie ? canvasRiskPie.getContext('2d') : null;
    const trendCtx = canvasTrend.getContext('2d');
    
    // Define weighted scores (default values, adjustable via Settings)
    let chestWeights = {
      "persistent_cough": 1,
      "low_grade_fever": 1,
      "chest_discomfort": 1,
      "wheezing": 1,
      "sore_throat": 1,
      "fatigue": 1
    };
    let pneumoniaWeights = {
      "high_fever": 2,
      "shaking_chills": 2,
      "severe_productive_cough": 2,
      "pleuritic_chest_pain": 3,
      "shortness_of_breath": 3,
      "confusion": 2,
      "nausea": 1,
      "cyanosis": 3
    };
    let riskFactorWeights = {
      "age_over_65": 2,
      "smoker": 2,
      "pre_existing": 2,
      "immunocompromised": 2
    };
    
    // Historical data for trend chart
    let evaluationHistory = [];
    
    // Create/update the Bar Chart
    function createBarChart(chestScore, pneumoniaScore) {
      if (symptomChart) symptomChart.destroy();
      symptomChart = new Chart(chartCtx, {
        type: 'bar',
        data: {
          labels: ['Chest Infection Score', 'Pneumonia Score'],
          datasets: [{
            label: 'Weighted Score',
            data: [chestScore, pneumoniaScore],
            backgroundColor: ['rgba(52, 152, 219, 0.6)', 'rgba(231, 76, 60, 0.6)'],
            borderColor: ['rgba(41, 128, 185, 1)', 'rgba(192, 57, 43, 1)'],
            borderWidth: 1
          }]
        },
        options: { scales: { y: { beginAtZero: true, precision: 0 } } }
      });
    }
    
    // Create/update the Radar Chart
    function createRadarChart(chestScore, pneumoniaScore) {
      if (radarChart) radarChart.destroy();
      const chestTotal = Object.values(chestWeights).reduce((a, b) => a + b, 0);
      const pneumoniaTotal = Object.values(pneumoniaWeights).reduce((a, b) => a + b, 0) +
                               Object.values(riskFactorWeights).reduce((a, b) => a + b, 0);
      const chestPercentage = ((chestScore / chestTotal) * 100).toFixed(0);
      const pneumoniaPercentage = ((pneumoniaScore / pneumoniaTotal) * 100).toFixed(0);
      radarChart = new Chart(radarCtx, {
        type: 'radar',
        data: {
          labels: ['Chest Infection (%)', 'Pneumonia (%)'],
          datasets: [{
            label: 'Symptom Match (%)',
            data: [chestPercentage, pneumoniaPercentage],
            backgroundColor: 'rgba(155, 89, 182, 0.3)',
            borderColor: 'rgba(155, 89, 182, 1)',
            pointBackgroundColor: 'rgba(155, 89, 182, 1)',
            borderWidth: 2
          }]
        },
        options: { scales: { r: { beginAtZero: true, max: 100 } } }
      });
    }
    
    // Create/update the Risk Factor Pie Chart
    function createRiskPieChart() {
      if (!riskPieCtx) return;
      const riskBoxes = document.querySelectorAll('input[name="risk"]:checked');
      let riskData = {};
      riskBoxes.forEach(box => { riskData[box.value] = riskFactorWeights[box.value]; });
      const labels = Object.keys(riskData);
      const data = Object.values(riskData);
      if (riskPieChart) riskPieChart.destroy();
      riskPieChart = new Chart(riskPieCtx, {
        type: 'pie',
        data: {
          labels: labels,
          datasets: [{
            label: 'Risk Factor Weights',
            data: data,
            backgroundColor: labels.map(() => 'rgba(46, 204, 113, 0.6)'),
            borderColor: labels.map(() => 'rgba(39, 174, 96, 1)'),
            borderWidth: 1
          }]
        },
        options: {}
      });
    }
    
    // Create/update the Trend Chart (line chart for historical evaluation)
    function createTrendChart() {
      if (trendChart) trendChart.destroy();
      const labels = evaluationHistory.map((_, idx) => "Eval " + (idx + 1));
      trendChart = new Chart(trendCtx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Evaluation Score (Pneumonia - Chest)',
            data: evaluationHistory,
            backgroundColor: 'rgba(231, 76, 60, 0.3)',
            borderColor: 'rgba(231, 76, 60, 1)',
            fill: true,
            tension: 0.2
          }]
        },
        options: { scales: { y: { beginAtZero: true } } }
      });
    }
    
    // Simulate lung sound analysis (new innovation)
    function simulateLungSoundAnalysis() {
      const score = Math.floor(Math.random() * 10) + 1; // Score between 1 and 10
      const displayText = "Lung Sound Score: " + score;
      let lungSoundEl = document.getElementById('lungSoundData');
      if (!lungSoundEl) {
        lungSoundEl = document.createElement('p');
        lungSoundEl.id = 'lungSoundData';
        document.getElementById('wearableDashboard').appendChild(lungSoundEl);
      }
      lungSoundEl.innerText = displayText;
      return score;
    }
    
    // Simulate wearable data (includes vitals)
    function simulateWearableData() {
      const data = {
        heartRate: Math.floor(Math.random() * 20) + 60,
        temperature: (Math.random() * 0.5 + 36.5).toFixed(1),
        respirationRate: Math.floor(Math.random() * 6) + 12,
        oxygenSaturation: Math.floor(Math.random() * 3) + 95
      };
      const text = `Heart Rate: ${data.heartRate} bpm | Temp: ${data.temperature}°C | Respiration: ${data.respirationRate} bpm | O₂ Sat: ${data.oxygenSaturation}%`;
      document.getElementById('wearableData').innerText = text;
      return data;
    }
    
    // Live update for wearable data every 10 seconds
    function startWearableUpdates() {
      setInterval(simulateWearableData, 10000);
    }
    
    // Generate suggestion based on score difference
    function generateSuggestion(chestScore, pneumoniaScore) {
      const diff = pneumoniaScore - chestScore;
      if (diff >= 3) { return "strongly suggests pneumonia. Please seek medical attention immediately."; }
      else if (diff > 0) { return "leans towards pneumonia. It is advised to consult a healthcare professional."; }
      else if (diff < -2) { return "strongly suggests a chest infection (bronchitis). Monitor your symptoms and consult your doctor if they worsen."; }
      else if (diff < 0) { return "leans towards a chest infection. However, if symptoms worsen, seek medical advice."; }
      else { return "is inconclusive. Please consult a healthcare provider for an accurate evaluation."; }
    }
    
    // Evaluate symptoms and risk factors using weighted algorithm and incorporate lung sound analysis
    function evaluateSymptoms() {
      const evalEl = document.getElementById('evaluationResult');
      if (!evalEl) { console.error("evaluationResult element not found."); return; }
      
      const checkedSymptomBoxes = document.querySelectorAll('input[name="symptom"]:checked');
      let chestScore = 0, pneumoniaScore = 0;
      checkedSymptomBoxes.forEach(box => {
        const value = box.value;
        if (chestWeights[value]) chestScore += chestWeights[value];
        if (pneumoniaWeights[value]) pneumoniaScore += pneumoniaWeights[value];
      });
      
      const checkedRiskBoxes = document.querySelectorAll('input[name="risk"]:checked');
      let riskScore = 0;
      checkedRiskBoxes.forEach(box => {
        const value = box.value;
        if (riskFactorWeights[value]) riskScore += riskFactorWeights[value];
      });
      pneumoniaScore += riskScore;
      
      // Incorporate wearable data: if temperature > 37°C add extra weight to pneumonia
      const wearable = simulateWearableData();
      if (parseFloat(wearable.temperature) > 37.0) { pneumoniaScore += 1; }
      
      // Incorporate lung sound analysis: if score < 5 add weight to pneumonia
      const lungSoundScore = simulateLungSoundAnalysis();
      if (lungSoundScore < 5) { pneumoniaScore += 2; }
      
      const suggestion = generateSuggestion(chestScore, pneumoniaScore);
      const resultMsg = "Your weighted profile suggests: " + suggestion;
      
      safeSetInnerHTML('evaluationResult', "<p>" + resultMsg + "</p><p><em>This tool is for informational purposes only and is not a substitute for professional medical advice.</em></p>");
      
      createBarChart(chestScore, pneumoniaScore);
      createRadarChart(chestScore, pneumoniaScore);
      createRiskPieChart();
      
      // Update historical trend
      const scoreDiff = pneumoniaScore - chestScore;
      evaluationHistory.push(scoreDiff);
      createTrendChart();
      
      // Update Evaluation Summary Stats
      updateStats();
      
      const selectedSymptoms = Array.from(checkedSymptomBoxes).map(box => box.value);
      const selectedRiskFactors = Array.from(checkedRiskBoxes).map(box => box.value);
      localStorage.setItem('selectedSymptoms', JSON.stringify(selectedSymptoms));
      localStorage.setItem('selectedRiskFactors', JSON.stringify(selectedRiskFactors));
      localStorage.setItem('evaluationResult', resultMsg);
      const now = new Date().toLocaleString();
      localStorage.setItem('lastEvaluation', now);
      safeSetInnerHTML('lastEval', "Last Evaluation: " + now);
      
      console.log("Chest Score:", chestScore, "Pneumonia Score:", pneumoniaScore, "Result:", resultMsg);
    }
    
    // Update Evaluation Summary Statistics
    function updateStats() {
      if (evaluationHistory.length === 0) {
        safeSetInnerHTML('statsText', "No evaluations yet.");
        return;
      }
      const avg = (evaluationHistory.reduce((a, b) => a + b, 0) / evaluationHistory.length).toFixed(2);
      const min = Math.min(...evaluationHistory);
      const max = Math.max(...evaluationHistory);
      safeSetInnerHTML('statsText', `Total Evaluations: ${evaluationHistory.length} | Avg Score Diff: ${avg} | Min: ${min} | Max: ${max}`);
    }
    
    // Reset selections, charts, and localStorage
    function resetSelections() {
      document.getElementById('symptomForm').reset();
      document.getElementById('riskFactorForm').reset();
      localStorage.removeItem('selectedSymptoms');
      localStorage.removeItem('selectedRiskFactors');
      localStorage.removeItem('evaluationResult');
      localStorage.removeItem('lastEvaluation');
      safeSetInnerHTML('evaluationResult', "<p><em>This tool is for informational purposes only and is not a substitute for professional medical advice.</em></p>");
      safeSetInnerHTML('lastEval', "");
      evaluationHistory = [];
      createBarChart(0, 0);
      createRadarChart(0, 0);
      createRiskPieChart();
      createTrendChart();
      updateStats();
      console.log("Selections reset.");
    }
    
    // Download report as TXT file
    function downloadReport() {
      const resultText = localStorage.getItem('evaluationResult') || "No evaluation result available.";
      const symptoms = localStorage.getItem('selectedSymptoms') || "No symptoms selected.";
      const risks = localStorage.getItem('selectedRiskFactors') || "No risk factors selected.";
      const lastEval = localStorage.getItem('lastEvaluation') || "Not evaluated yet.";
      const report = "Symptom Evaluation Report\n\nSelected Symptoms:\n" + symptoms +
                     "\n\nSelected Risk Factors:\n" + risks +
                     "\n\nEvaluation Result:\n" + resultText +
                     "\n\nLast Evaluation: " + lastEval;
      const blob = new Blob([report], { type: "text/plain;charset=utf-8" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "Symptom_Evaluation_Report.txt";
      link.click();
      console.log("TXT Report downloaded.");
    }
    
    // Export report as PDF using jsPDF
    function exportPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const resultText = localStorage.getItem('evaluationResult') || "No evaluation result available.";
      const symptoms = localStorage.getItem('selectedSymptoms') || "No symptoms selected.";
      const risks = localStorage.getItem('selectedRiskFactors') || "No risk factors selected.";
      const lastEval = localStorage.getItem('lastEvaluation') || "Not evaluated yet.";
      doc.text("Symptom Evaluation Report", 10, 10);
      doc.text("Selected Symptoms: " + symptoms, 10, 20);
      doc.text("Selected Risk Factors: " + risks, 10, 30);
      doc.text("Evaluation Result: " + resultText, 10, 40);
      doc.text("Last Evaluation: " + lastEval, 10, 50);
      doc.save("Symptom_Evaluation_Report.pdf");
      console.log("PDF Report exported.");
    }
    
    // Export trend data as CSV
    function exportTrendCSV() {
      let csvContent = "data:text/csv;charset=utf-8,Evaluation,ScoreDiff\n";
      evaluationHistory.forEach((score, idx) => {
        csvContent += `Eval ${idx+1},${score}\n`;
      });
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "evaluation_trend.csv");
      document.body.appendChild(link);
      link.click();
      console.log("Trend CSV exported.");
    }
    
    // Chatbot Assistant: sendChat function definition
    function sendChat() {
      const input = document.getElementById('chatInput');
      const chatLog = document.getElementById('chatLog');
      if (input.value.trim() === "") return;
      // Append user's message
      chatLog.innerHTML += "<p><strong>You:</strong> " + input.value + "</p>";
      // Simulated response (replace with real LLM API call if desired)
      let response = "";
      const lowerText = input.value.toLowerCase();
      if (lowerText.includes("what")) {
        response = "Based on your evaluation, if pneumonia risk is higher, please consider seeking immediate medical attention.";
      } else if (lowerText.includes("why")) {
        response = "The evaluation is based on your selected symptoms, risk factors, and simulated wearable data.";
      } else {
        response = "I'm here to help. Your evaluation result is: " + localStorage.getItem('evaluationResult');
      }
      chatLog.innerHTML += "<p><strong>Chatbot:</strong> " + response + "</p>";
      input.value = "";
      chatLog.scrollTop = chatLog.scrollHeight;
    }
    
    // Play evaluation result using Web Speech API
    function playResult() {
      const resultText = localStorage.getItem('evaluationResult');
      if (!resultText) {
        alert("No evaluation result to play. Please evaluate your symptoms first.");
        return;
      }
      try {
        const utterance = new SpeechSynthesisUtterance(resultText);
        speechSynthesis.speak(utterance);
        console.log("Result spoken.");
      } catch (error) {
        console.error("Speech synthesis error:", error);
      }
    }
    
    // Print report
    function printReport() {
      window.print();
    }
    
    // Record cough snippet using Web Audio API (simulation)
    function recordCough() {
      if (navigator && navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        navigator.mediaDevices.getUserMedia({ audio: true })
          .then(stream => {
            let mediaRecorder = new MediaRecorder(stream);
            mediaRecorder.start();
            safeSetInnerHTML('recorderStatus', "<p><em>Recording... Please cough.</em></p>");
            let audioChunks = [];
            mediaRecorder.addEventListener("dataavailable", event => {
              audioChunks.push(event.data);
            });
            setTimeout(() => {
              mediaRecorder.stop();
              safeSetInnerHTML('recorderStatus', "<p><em>Cough recording complete. (Analysis pending...)</em></p>");
              const coughAnalysisScore = Math.floor(Math.random() * 10) + 1;
              console.log("Cough Analysis Score:", coughAnalysisScore);
            }, 5000);
          })
          .catch(error => {
            console.error("Error accessing microphone:", error);
            alert("Microphone access is required to record your cough.");
          });
      } else {
        alert("Microphone access is not supported in this environment.");
      }
    }
    
    // Voice command for symptom selection using Web Speech API
    function startVoiceCommand() {
      try {
        if ((!window.SpeechRecognition && !window.webkitSpeechRecognition) || !navigator) {
          alert("Your browser does not support voice recognition.");
          return;
        }
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        recognition.lang = 'en-US';
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;
        safeSetInnerHTML('recorderStatus', "<p><em>Listening for voice commands...</em></p>");
        recognition.start();
        
        recognition.onresult = event => {
          const transcript = event.results[0][0].transcript.toLowerCase();
          console.log("Voice Command:", transcript);
          document.querySelectorAll('input[name="symptom"]').forEach(box => {
            if (transcript.includes(box.value.replace("_", " "))) {
              box.checked = true;
            }
          });
          evaluateSymptoms();
          safeSetInnerHTML('recorderStatus', "<p><em>Voice command processed.</em></p>");
        };
        recognition.onerror = event => {
          console.error("Voice recognition error:", event.error);
          safeSetInnerHTML('recorderStatus', "<p><em>Voice recognition error occurred.</em></p>");
        };
      } catch (error) {
        console.error("Voice command initialization error:", error);
      }
    }
    
    // Share result using Web Share API
    function shareResult() {
      const resultText = localStorage.getItem('evaluationResult') || "No evaluation result available.";
      if (navigator && navigator.share) {
        navigator.share({
          title: 'Symptom Evaluation Result',
          text: resultText,
          url: window.location.href
        }).then(() => {
          console.log("Result shared successfully.");
        }).catch(error => {
          console.error("Error sharing result:", error);
        });
      } else {
        alert("Web Share API is not supported on this browser.");
      }
    }
    
    // Share on Twitter
    function shareOnTwitter() {
      const resultText = localStorage.getItem('evaluationResult') || "No evaluation result available.";
      const tweetText = encodeURIComponent("My health evaluation: " + resultText);
      const tweetUrl = "https://twitter.com/intent/tweet?text=" + tweetText;
      window.open(tweetUrl, "_blank");
    }
    
    // Personal Health Journal functions
    function saveJournal() {
      const text = document.getElementById('journalText').value;
      if (text.trim() === "") return;
      let journalEntries = JSON.parse(localStorage.getItem('journalEntries') || "[]");
      journalEntries.push({ date: new Date().toLocaleString(), entry: text });
      localStorage.setItem('journalEntries', JSON.stringify(journalEntries));
      safeSetInnerHTML('journalStatus', "Journal entry saved.");
      document.getElementById('journalText').value = "";
    }
    function exportJournal() {
      const journalEntries = localStorage.getItem('journalEntries') || "No journal entries.";
      const blob = new Blob([journalEntries], { type: "text/plain;charset=utf-8" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "Personal_Health_Journal.txt";
      link.click();
      console.log("Journal TXT exported.");
    }
    
    // Settings Modal functions
    function openSettings() {
      document.getElementById('settingsModal').style.display = "block";
    }
    function closeSettings() {
      document.getElementById('settingsModal').style.display = "none";
    }
    function saveSettings() {
      // Update chestWeights
      chestWeights["persistent_cough"] = parseFloat(document.getElementById('w_persistent_cough').value) || 1;
      chestWeights["low_grade_fever"] = parseFloat(document.getElementById('w_low_grade_fever').value) || 1;
      chestWeights["chest_discomfort"] = parseFloat(document.getElementById('w_chest_discomfort').value) || 1;
      chestWeights["wheezing"] = parseFloat(document.getElementById('w_wheezing').value) || 1;
      chestWeights["sore_throat"] = parseFloat(document.getElementById('w_sore_throat').value) || 1;
      chestWeights["fatigue"] = parseFloat(document.getElementById('w_fatigue').value) || 1;
      // Update pneumoniaWeights
      pneumoniaWeights["high_fever"] = parseFloat(document.getElementById('w_high_fever').value) || 2;
      pneumoniaWeights["shaking_chills"] = parseFloat(document.getElementById('w_shaking_chills').value) || 2;
      pneumoniaWeights["severe_productive_cough"] = parseFloat(document.getElementById('w_severe_productive_cough').value) || 2;
      pneumoniaWeights["pleuritic_chest_pain"] = parseFloat(document.getElementById('w_pleuritic_chest_pain').value) || 3;
      pneumoniaWeights["shortness_of_breath"] = parseFloat(document.getElementById('w_shortness_of_breath').value) || 3;
      pneumoniaWeights["confusion"] = parseFloat(document.getElementById('w_confusion').value) || 2;
      pneumoniaWeights["nausea"] = parseFloat(document.getElementById('w_nausea').value) || 1;
      pneumoniaWeights["cyanosis"] = parseFloat(document.getElementById('w_cyanosis').value) || 3;
      // Update riskFactorWeights
      riskFactorWeights["age_over_65"] = parseFloat(document.getElementById('w_age_over_65').value) || 2;
      riskFactorWeights["smoker"] = parseFloat(document.getElementById('w_smoker').value) || 2;
      riskFactorWeights["pre_existing"] = parseFloat(document.getElementById('w_pre_existing').value) || 2;
      riskFactorWeights["immunocompromised"] = parseFloat(document.getElementById('w_immunocompromised').value) || 2;
      closeSettings();
      evaluateSymptoms();
      console.log("Settings updated.");
    }
    
    // Restore previous selections on page load
    function restoreSelections() {
      const savedSymptoms = localStorage.getItem('selectedSymptoms');
      if (savedSymptoms) {
        JSON.parse(savedSymptoms).forEach(value => {
          const checkbox = document.querySelector('input[name="symptom"][value="' + value + '"]');
          if (checkbox) checkbox.checked = true;
        });
      }
      const savedRisks = localStorage.getItem('selectedRiskFactors');
      if (savedRisks) {
        JSON.parse(savedRisks).forEach(value => {
          const checkbox = document.querySelector('input[name="risk"][value="' + value + '"]');
          if (checkbox) checkbox.checked = true;
        });
      }
      evaluateSymptoms();
    }
    
    // Attach event listeners when DOM is fully loaded
    document.addEventListener('DOMContentLoaded', function() {
      loadTheme();
      document.getElementById('toggleThemeBtn').addEventListener('click', toggleTheme);
      document.getElementById('evaluateBtn').addEventListener('click', evaluateSymptoms);
      document.getElementById('resetBtn').addEventListener('click', resetSelections);
      document.getElementById('downloadBtn').addEventListener('click', downloadReport);
      document.getElementById('exportPdfBtn').addEventListener('click', exportPDF);
      document.getElementById('playBtn').addEventListener('click', playResult);
      document.getElementById('printBtn').addEventListener('click', printReport);
      document.getElementById('recordBtn').addEventListener('click', recordCough);
      document.getElementById('voiceCmdBtn').addEventListener('click', startVoiceCommand);
      document.getElementById('shareBtn').addEventListener('click', shareResult);
      document.getElementById('exportCsvBtn').addEventListener('click', exportTrendCSV);
      document.getElementById('openSettingsBtn').addEventListener('click', openSettings);
      document.getElementById('toggleJournalBtn').addEventListener('click', function() {
        const journal = document.getElementById('journalSection');
        if(journal.style.display === "none" || journal.style.display === "") { journal.style.display = "block"; }
        else { journal.style.display = "none"; }
      });
      document.getElementById('openHelpBtn').addEventListener('click', function() {
        alert("Instructions:\n1. Select your symptoms and risk factors.\n2. Click 'Evaluate Symptoms' to compute a weighted score.\n3. The wearable dashboard simulates vital signs and lung sound analysis (updates every 10 seconds).\n4. Adjust weightings via the Settings modal.\n5. Record your health notes in the Personal Health Journal.\n6. Export reports as TXT, PDF, or CSV.\n7. Share results on Twitter or via the Web Share API.\n8. Data Analysis mode displays summary statistics.");
      });
      
      // Add change event listeners for symptom and risk selectors
      document.querySelectorAll('input[name="symptom"]').forEach(box => {
        box.addEventListener('change', evaluateSymptoms);
      });
      document.querySelectorAll('input[name="risk"]').forEach(box => {
        box.addEventListener('change', evaluateSymptoms);
      });
      restoreSelections();
      console.log("Advanced Chest Infection vs Pneumonia Diagnostic Tool loaded successfully.");
      startWearableUpdates();
      // Request Notification permission for push reminders
      if ("Notification" in window && Notification.permission !== "granted") {
        Notification.requestPermission();
      }
    });
    
    // Push Notification Reminder every 60 seconds
    setInterval(function notifyReminder() {
      if (!("Notification" in window)) return;
      if (Notification.permission === "granted") {
        new Notification("Time to update your health evaluation!");
      }
    }, 60000);
    
  </script>
  
  <!-- Settings Modal -->
  <div id="settingsModal">
    <div id="settingsContent">
      <h2>Adjust Weight Settings</h2>
      <form id="settingsForm">
        <h3>Symptom Weights</h3>
        <label>Persistent Cough: <input type="number" step="0.1" id="w_persistent_cough" value="1"></label><br>
        <label>Low-Grade Fever: <input type="number" step="0.1" id="w_low_grade_fever" value="1"></label><br>
        <label>Chest Discomfort: <input type="number" step="0.1" id="w_chest_discomfort" value="1"></label><br>
        <label>Wheezing: <input type="number" step="0.1" id="w_wheezing" value="1"></label><br>
        <label>Sore Throat: <input type="number" step="0.1" id="w_sore_throat" value="1"></label><br>
        <label>Fatigue: <input type="number" step="0.1" id="w_fatigue" value="1"></label><br>
        <h3>Pneumonia Weights</h3>
        <label>High Fever: <input type="number" step="0.1" id="w_high_fever" value="2"></label><br>
        <label>Shaking Chills: <input type="number" step="0.1" id="w_shaking_chills" value="2"></label><br>
        <label>Severe Productive Cough: <input type="number" step="0.1" id="w_severe_productive_cough" value="2"></label><br>
        <label>Pleuritic Chest Pain: <input type="number" step="0.1" id="w_pleuritic_chest_pain" value="3"></label><br>
        <label>Shortness of Breath: <input type="number" step="0.1" id="w_shortness_of_breath" value="3"></label><br>
        <label>Confusion: <input type="number" step="0.1" id="w_confusion" value="2"></label><br>
        <label>Nausea: <input type="number" step="0.1" id="w_nausea" value="1"></label><br>
        <label>Cyanosis: <input type="number" step="0.1" id="w_cyanosis" value="3"></label><br>
        <h3>Risk Factor Weights</h3>
        <label>Age Over 65: <input type="number" step="0.1" id="w_age_over_65" value="2"></label><br>
        <label>Smoker: <input type="number" step="0.1" id="w_smoker" value="2"></label><br>
        <label>Pre-existing Conditions: <input type="number" step="0.1" id="w_pre_existing" value="2"></label><br>
        <label>Immunocompromised: <input type="number" step="0.1" id="w_immunocompromised" value="2"></label><br>
      </form>
      <button class="btn" onclick="saveSettings()">Save Settings</button>
      <button class="btn" onclick="closeSettings()">Close</button>
    </div>
  </div>
  
  <!-- Journal Section (hidden by default) -->
  <div id="journalSection" style="display: none;">
    <h2>Personal Health Journal</h2>
    <textarea id="journalText" placeholder="Write your daily health notes here..."></textarea>
    <br>
    <button class="btn" onclick="saveJournal()">Save Journal Entry</button>
    <button class="btn" onclick="exportJournal()">Export Journal TXT</button>
    <div id="journalStatus"></div>
  </div>
  
  <!-- Additional script for Twitter sharing and Data Analysis Mode -->
  <script>
    document.getElementById('shareTwitterBtn').addEventListener('click', shareOnTwitter);
    document.getElementById('exportAnalysisBtn').addEventListener('click', showAnalysis);
    
    // Data Analysis Mode: Display additional summary statistics
    function showAnalysis() {
      updateStats();
      alert("Data Analysis:\n" + document.getElementById('statsText').innerText);
    }
  </script>
  
</body>
</html>
